---
title: "test_run"
author: "Peter Lin"
date: "April 9, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

```{r API interaction setup}
# Examples of interaction with the API

#' Format of the authorization part for obtaining content
#' @return authorization string to be sent with a GET requeset
Authorization <- function(token_string){
  token <- get_token(token_string)
  return( paste("Bearer", token) )
}

#' Airport Reference Content.
#'
#' @param abbr The airport abbreviation. Default is 'YVR', the Vancouver Airport
#' @return httr content object
#' @export
airport <- function(abbr = "YVR"){

  url_airport_api <- "https://api.lufthansa.com/v1/references/airports/"
  url_airport_api_airport <- paste0(url_airport_api, abbr)

  # Getting the content from the Airport Resources API
  received_content <- httr::GET(url = url_airport_api_airport,
                                config = httr::add_headers(Authorization = Authorization()))

  airport_content <- httr::content(received_content, "parsed")
  return(airport_content)
}
```

```{r API interaction setup2}

api_key <- "k3fbdmthnna62q2xzw6987wu"
 
api_secret <- "s2UnpgMQw6"
 
my_auth_token <- "y3dv6bvz5zzr6tsh9gabtetm"

# http://www.dartistics.com/creating-apis.html 
call_api <- function(hosts){
  
  base_url <- "https://api-sandbox.lufthansa.com/v1/flight_operations/crew_services"
  
  call_url <- paste0(base_url, "?hosts=", hosts,"&key=",my_auth_token)
  
  message("Calling ", call_url)
  req <- httr::GET(call_url)
  
  if(req$status_code != 200){
    stop("Problem with calling the API - response: ", content(req))
  }
  
  # this content is tricky to parse into text, so this bit is done for you
  response_content <- rawToChar(content(req, "raw"))
  json_response <- fromJSON(response_content)
  
  ## add something here to parse json_response into something readable
  json_response
}

```

